# Google Analytics
**Google Analytics?** 구글에서 무료로 제공하고 있는 웹로그 분석 서비스<br>
사이트 코드에 GA 스크립트를 넣으면 접속한 유저들의 행동을 GA 서버로 보내 분석할 수 있다.

* [1. 설치하기](#1-설치하기)
* [2. GA 페이지 둘러보기](#2-ga-페이지-둘러보기)
    - [메뉴](#21-메뉴)
    - [핵심 분석 기술](#22-핵심-분석-기술)
* [3. 획득](#3-획득)
    - [채널](#31-채널)
    - [캠페인](#32-캠페인)
* [4. 방문 형태](#4-방문-형태)
    - [이벤트 트래킹](#41-이벤트-트래킹)
    - [행동 분류](42-행동-분류)
    - [A/B 테스트](#43-ab-테스트)
* [5. 전환](#5-전환)

## 1. 설치하기
https://analytics.google.com/<br>
추적 코드를 `head` tag에 삽입한다.
```html
<script>
    (function (i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r;
        i[r] = i[r] || function () {
                  (i[r].q = i[r].q || []).push(arguments)
              }, i[r].l = 1 * new Date();
        a = s.createElement(o),
              m = s.getElementsByTagName(o)[0];
        a.async = 1;
        a.src = g;
        m.parentNode.insertBefore(a, m)
    })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

    ga('create', 'UA-추적ID', 'auto');
    ga('send', 'pageview'); // 사용자가 보는 페이지를 정보를 기본으로 전송
</script>
```

설치 후 GA 페이지에서 통계를 확인할 수 있다.

## 2. GA 페이지 둘러보기
본격적인 코드 삽입에 들어가기 전에 GA 페이지에서 데이터를 읽는 법을 알아보자

### 2.1 메뉴
* 지능형 이벤트
    - 사이트에 특별한 변화가 생기면 구글이 자동으로 여기에 로그를 기록!
* 실시간
    - 지금 당장 유저들이어디서 왔고 무슨 페이지를 보고 있고 뭐하고 있는지가 뜬다
* 잠재고객
    - 우리 페이지 안에 들어온 모든 손님들의 자체의 특성에 집중! 
    - 나이대, 모바일인지, 얼마나 머무는지, 얼마만에 왔는지 등등..
* 획득
    - 우리 페이지에 뭘 보고 들어왔는지, 어떤 링크를 타고 왔고 어떤 광고를 보고 왔는지
* 방문형태 
    - '잠재고객'이 손님의 특성을 봤다면 '방문형태'는 손님의 활동을 본다. 와서 뭘 보는지..
* 전환
    - 실제 가입을 했는지 판매를 했는지 등의 KPI로 생각하는 목표

### 2.2 핵심 분석 기술

#### 세션
사용자의 활동은 `세션`단위로 표현된다. (중간에 30분 이상 뜨는 시간이 생기면 세션을 분리함)

`세션 시간`은 다음 페이지를 로드한 시간에서 이전 페이지를 로드한 시간을 뺀 것

#### 세그먼트
GA에서 제공하는 다양한 기준으로 사용자를 `세그먼트`단위로 필터링 할 수 있다.<br>
사용자의 연령/성별/브라우저 및 운영체제 버전 등!

`세그먼트`를 이용하면 하위 데이터를 선별하여 분석할 수 있다. 데이터의 세그먼트를 자세히 살펴보면 전체 데이터에 변화를 가져온 원인을 효과적으로 파악할 수 있다.

어느 마케팅 채널이 구매 증대에 기여했을까?<br>
모바일 트래픽과 데스크탑 트래픽을 나눠본다면?<br>
아이폰4 사용자가 우리 페이지에 들어왔을 때의 패턴은?

`관리 - 보기 - 세그먼트` 에서 GA에서 기본적으로 설정한 세그먼트 말고도 맞춤으로 만들 수 있다.

#### 이탈률
`이탈률`은 사용자가 세션에서 페이지와 상호작용하지 않고 사이트를 떠난 단일 페이지 세션의 비율이다.<br>
즉, 페이지에 진입해서 해당 페이지만 보고 웹 사이트를 이탈한 것.

페이지를 이탈하면 다음페이지에 로드되는 시간이 기록되지 않음 —> 세션시간이 0분 = 이탈

한 페이지의 많은 내용을 읽고 유용한 정보를 제공했어도 그 페이지만 보고 나가면 이탈로 집계됨.

#### 페이지 값
`페이지 값`은 사용자가 목표 페이지에 도달하거나 전자상거래를 완료하기 전에 방문한 페이지의 평균 가치이다.<br>이를 통해 수익에 가장 많이 기여한 페이지를 알 수 있다.

#### 목표
제품이나 서비스 판매, 사용자 참여 유도 등 모든 사이트에는 목표가 있다.<br>
목표를 파악하면 사이트의 디자인이 사용자 성공에 어느 정도 도움이 되는지 알 수 있다.

`관리 - 보기 - 목표` 에서 목표를 생성하자.

1. 목표 설정 - 이루고자 하는 목표의 탬플릿을 설정
2. 목표 설명 - 이루고자 하는 목표의 이름과 그 유형을 선택한다
3. 목표 세부정보 - 목표 유형을 바탕으로 세부정보를 작성한다

목표의 유형은 다음과 같다.

* 도착지: 사용자가 도달하는 특정 페이지 (유입경로 설정도 가능)
* 시간: 사용자가 사이트에 머무는 최소 시간
* 세션당 페이지 수: 사용자가 조회한 최소 페이지 수
* 이벤트: 사용자가 수행한 특정 행동. (목표 이벤트의 category / action / label)

목표는 20개까지 만들 수 있고, 한 번 만든 목표는 삭제가 불가능하다. (하지만 수정가능)

## 3. 획득
사용자들의 유입경로를 타입별로 지정해주고 추적해보자.

### 3.1 채널
획득 보고서를 보면 어디서 링크를 타고 들어왔는지 구글의 나름의 규칙으로 채널을 분류해놓았다.

* Direct: 북마크, 주소
* Organic Search: 검색결과
* Referral: 블로그나 게시판 링크
* Social: 페북, 트위터
* Display: 노출형 광고 (배너광고)
* Paid Search: 유료 키워드

> 하지만 미국 기준이라서 네이버를 통해 들어온거는 자연검색으로 분류되는 문제가 있다!

### 3.2 캠페인
채널에서 제공하는 것보다 링크의 출처를 확실하게 해야하는 경우, 캠페인의 `UTM 파라미터`를 이용해서 자동으로 분류시킬 수 있다.

`UTM 파라미터` - 주소 자체가 출처를 담는 체계

* source - 캠페인 소스 / 트래픽이 어디로부터 왔는가 / ex) facebook, naver, kakaostory, piki
* medium - 캠페인 매체 / 트래픽이 어떤 타입의 광고로 왔는가 / ex) knowhow, exhibition, email
* campaign - 캠페인 이름 / 기간 한정과 같이 특별히 진행하는 캠페인인가
* term - 캠페인 검색어 / 어떤 단어를 검색해서 왔나
* content - 캠페인 내용 / 어떤 내용을 보고 왔나 / ex) 캠페인 광고의 AB 성과 측정을 하고싶을 때

마케팅 팀에서는 외부에 링크를 올릴 때 url에 UTM parameter를 붙여서 올리면 된다.<br>
코드 상에서는 메일러를 보내 유저에게 링크를 제공할 때, 유저가 컨텐츠를 공유하게 할 때 아래와 같이 UTM parameter를 추가한 url을 주면 된다.
```ruby
@url = @url + "?utm_source=email&utm_medium=scrap&utm_campaign=retention"
```

## 4. 방문 형태
사용자들의 행동을 분류하고 추적해보자.

### 4.1 이벤트 트래킹
사이트 내에서 일어나는 특정 이벤트들을 이름을 짓고 추적해보자.

페이지뷰나, 클릭, 폼 전송 등이 일어나면 이를 캐치해서 이름(범주)을 지어주는 행위가 구글 애널리틱스의 `Event Tracking`이다.
```JavaScript
ga('send', {
        hitType: 'event',
        eventCategory: '좋아요',
        eventAction: '카드피드',
        eventLabel: '디테일'
    });

ga('send','event','좋아요','카드피드','디테일'); // 이렇게 줄여써도 됨
```

### 4.2 행동 분류

GA에 이벤트를 보낼 때 행동을 `Category` `Action` `Label` 3단계로 나누어 보낼 수 있다.

GA를 보낼 때 이벤트의 분류 기준을 어떻게 하는가는 중요한 이슈다.

예를 들어, 사용자들이 '좋아요'를 누르는 행태에 대해 분석해보고 싶다고 하자.<br>
그러면 GA코드를 좋아요를 클릭하는 모든 이벤트에 넣게 될 것이다.

`대분류 - Category`는 모든 이벤트가 공통으로 갖는 '좋아요 누름'<br>
`중분류 - Action`는 어떤 피드를 좋아요를 누른 건지 (card/project/advice/exhibition)<br>
`소분류 - Label`는 해당 피드를 어디에서 눌렀는지 (feed/detail)

### 4.3 A/B 테스트
`A/B 테스트`를 통해 사이트의 효율을 높일 수 있도록 여러 가지 패턴을 비교하여 사용자에게 보다 효과적인 디자인을 확인 할 수 있다.<br>
`방문 형태 - 실험` 통해서 A/B 테스트를 진행할 수 있다.

**실험 목표 선택**

* 실험 목적 - 테스트를 통해 확인하고 싶은 목표를 설정하면 새로운 페이지와 기존 페이지의 전환율 영향을 측정한다.
* 실험할 트래픽 비율 - 이 테스트에 참여하는 트래픽의 비율을 설정할 수 있다.
* 트래픽 고르게 분산 - 이 옵션을 사용하지 않으면 테스트 실적에 따라 동적으로 트래픽이 조정된다. 자동 최적화를 하지 않고 균등하게 테스트하려면 이 옵션을 사용하자.

기본적으로 실험 목적은 GA에 설정한 `목표`에 대한 전환율로 설정한다.

하지만 A/B 테스트를 통해 한 가지 목표가 아닌 multivariate로 보고자 한다면?<br>
분석하고자 하는 이벤트들을 페이지 내에 추가하여 이벤트 발생 빈도를 계산하자.
```JavaScript
// 원본 페이지 A
ga('send','event','production_AB','scrap','A');
ga('send','event','production_AB','share','A');
// 대안 페이지 B
ga('send','event','production_AB','scrap','B');
ga('send','event','production_AB','share','B');
```

**실험 구성하기**

원본페이지와 대안페이지의 주소를 입력한다.

원본 페이지에 URL parameter를 설정했으면 미리보기를 표시하는 경우를 제외하고 parameter가 무시되고,<br>
대안 페이지에 URL parameter를 설정했으면 사용자에게 표시되는 URL에 해당 parameter가 포함된다.

> 자세한 건 [여기](https://support.google.com/analytics/answer/2618450?hl=ko&authuser=1)를 참조하자.

대안 페이지 URL을 상대 URL로 정의할 수 있다.<br>
대안 페이지가 원본 URL의 일부(예: 도메인, 도메인과 경로 등)를 상속할 수 있다.<br>
페이지 URL에 route scope에서 정의한 parameter 있을 때 유용하다.

> 자세한 건 [여기](https://support.google.com/analytics/answer/2664470?hl=ko&authuser=1)를 참조하자.

**실험 코드 설정**

원본페이지의 `head` 태그 바로 다음에 실험 코드를 삽입한다.

## 5. 전환

<br><br><br>
[참고 블로그](https://milooy.wordpress.com/2016/01/14/google-analtyics-1-intro/)<br>
[참고 슬라이드](http://www.slideshare.net/yongho/ga-47277482)