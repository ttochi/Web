# Google Analytics
사이트 코드에 GA 스크립트를 넣으면 접속한 유저들의 행동을 GA 서버로 보내 분석할 수 있다.

## 1. 설치하기
https://analytics.google.com/<br>
추적 코드를 `head` tag에 삽입한다. (레일즈에서 `layout/application.html.erb`에 넣었다)
```html
<script>
    (function (i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r;
        i[r] = i[r] || function () {
                  (i[r].q = i[r].q || []).push(arguments)
              }, i[r].l = 1 * new Date();
        a = s.createElement(o),
              m = s.getElementsByTagName(o)[0];
        a.async = 1;
        a.src = g;
        m.parentNode.insertBefore(a, m)
    })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

    ga('create', 'UA-추적ID', 'auto');
    ga('send', 'pageview'); // 사용자가 보는 페이지를 정보를 기본으로 전송
</script>
```

설치 후 GA 페이지에서 통계를 확인할 수 있다.

## 2. GA 페이지 둘러보기
본격적인 코드 삽입에 들어가기 전에 GA 페이지에서 데이터를 읽는 법을 알아보자

### 2.1 메뉴
* 지능형 이벤트
    - 사이트에 특별한 변화가 생기면 구글이 자동으로 여기에 로그를 기록!
* 실시간
    - 지금 당장 유저들이어디서 왔고 무슨 페이지를 보고 있고 뭐하고 있는지가 뜬다
* 잠재고객
    - 우리 페이지 안에 들어온 모든 손님들의 자체의 특성에 집중! 
    - 나이대, 모바일인지, 얼마나 머무는지, 얼마만에 왔는지 등등..
* 획득
    - 우리 페이지에 뭘 보고 들어왔는지, 어떤 링크를 타고 왔고 어떤 광고를 보고 왔는지
* 방문형태 
    - '잠재고객'이 손님의 특성을 봤다면 '방문형태'는 손님의 활동을 본다. 와서 뭘 보는지..
* 전환
    - 실제 가입을 했는지 판매를 했는지 등의 KPI로 생각하는 목표

### 2.2 사용자 설정

**세션**

사용자의 활동은 `세션`단위로 표현된다. (중간에 30분 이상 뜨는 시간이 생기면 세션을 분리함)

**세그먼트**

GA에서 제공하는 다양한 기준으로 사용자를 `세그먼트`단위로 필터링 할 수 있다.<br>
사용자의 연령/성별/브라우저 및 운영체제 버전 등!

## 3. 이벤트 트래킹

### 3.1 행동 (방문 형태)
사이트 내에서 일어나는 특정 이벤트들을 이름을 짓고 추적해보자.

페이지뷰나, 클릭, 폼 전송 등이 일어나면 이를 캐치해서 이름(범주)을 지어주는 행위가 구글 애널리틱스의 `Event Tracking`이다.
```JavaScript
ga('send', {
        hitType: 'event',
        eventCategory: '좋아요',
        eventAction: '카드피드',
        eventLabel: '디테일'
    });

ga('send','event','좋아요','카드피드','디테일') // 이렇게 줄여써도 됨
```

**행동 분류**

GA에 이벤트를 보낼 때 행동을 `Category` `Action` `Label` 3단계로 나누어 보낼 수 있다.

GA를 보낼 때 이벤트의 분류 기준을 어떻게 하는가는 중요한 이슈다.

예를 들어, 사용자들이 '좋아요'를 누르는 행태에 대해 분석해보고 싶다고 하자.<br>
그러면 GA코드를 좋아요를 클릭하는 모든 이벤트에 넣게 될 것이다.<br>
`대분류 - Category`는 모든 이벤트가 공통으로 갖는 '좋아요 누름'<br>
`중분류 - Action`는 어떤 피드를 좋아요를 누른 건지 (card/project/advice/exhibition)<br>
`소분류 - Label`는 해당 피드를 어디에서 눌렀는지 (feed/detail)

### 3.2 획득
사용자들의 유입경로를 타입별로 지정해주고 추적해보자.

**채널**

획득 보고서를 보면 어디서 링크를 타고 들어왔는지 구글의 나름의 규칙으로 채널을 분류해놓았다.

* organic search: 검색결과
* direct: 북마크, 주소
* referral: 블로그나 게시판 링크
* paid search: 유료 키워드
* social: 페북, 트위터
* display: 노출형 광고 (배너광고)

> 미국 기준이라서 네이버를 통해 들어온거는 자연검색으로 분류됨

**UTM 파라미터**

채널에서 제공하는 것보다 링크의 출처를 확실하게 해야하는 경우 UTM 파라미터를 이용해서 자동으로 분류시킬 수 있다.

* source - 트래픽이 어디로부터 왔는가 / facebook, naver, kakaostory, piki
* medium - 트래픽이 어떤 타입의 광고로 왔는가 / knowhow, exhibition, email
* campaign - 기간 한정과 같이 특별히 진행하는 캠페인인가
* term - 어떤 단어를 검색해서 왔나
* content - 어떤 내용을 보고 왔나

마케팅 팀에서는 외부에 링크를 올릴 때 url에 UTM parameter를 붙여서 올리면 된다.<br>
코드 상에서는 메일러를 보내 유저에게 링크를 제공할 때, 유저가 컨텐츠를 공유하게 할 때 아래와 같이 UTM parameter를 추가한 url을 주면 된다.
```ruby
@url = @url + "?utm_campaign=retention&utm_source=email&utm_medium=scrap"
```

<br><br><br>
[참고 블로그](https://milooy.wordpress.com/2016/01/14/google-analtyics-1-intro/)
[참고 슬라이드](http://www.slideshare.net/yongho/ga-47277482)